/* -*- c++ -*- */
/* 
 * Copyright 2013 TRITONS
 *
 * Convolve the input against a PN sequence to find the frame boundary.
 * 
 * <<<=================================================================>>>
 * <<<=================================================================>>>
 * <<< This file is autogenerated from pngen.pl.  Do not edit directly >>>
 * <<<=================================================================>>>
 * <<<=================================================================>>>
 * 
 * This is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3, or (at your option)
 * any later version.
 * 
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this software; see the file COPYING.  If not, write to
 * the Free Software Foundation, Inc., 51 Franklin Street,
 * Boston, MA 02110-1301, USA.
 */

#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include <gr_io_signature.h>
#include <complex>
#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include "correlator_cc_impl.h"
#include "TRITONS.h"

#if (1023 != PREAMBLE_SYMBOL_LENGTH)
//#error Mismatch preamble length (1023 != PREAMBLE_SYMBOL_LENGTH)
#endif

namespace gr {
namespace correlator_cc {

static const int MIN_IN = 1;  // mininum number of input streams
static const int MAX_IN = 1;  // maximum number of input streams
static const int MIN_OUT = 1; // minimum number of output streams
static const int MAX_OUT = 1; // maximum number of output streams

correlator_cc::sptr
correlator_cc::make()
{
   return gnuradio::get_initial_sptr (new correlator_cc_impl());
}

/*
 * The private constructor
 */
correlator_cc_impl::correlator_cc_impl()
   : gr_block(
        "correlator_cc",
        gr_make_io_signature(MIN_IN, MAX_IN, sizeof(gr_complex)),
        gr_make_io_signature(MIN_OUT, MAX_OUT, sizeof(gr_complex)))
	
{
   for (int i=0; i<ACCUMULATOR_LENGTH; ++i)
   {
      _accRealOdd[i] = 0;
      _accImagOdd[i] = 0;

      _accRealEven[i] = 0;
      _accImagEven[i] = 0;
   }
   _accIndexOdd = 0;
   _accIndexEven = 0;

   _sampleNum = 0;
   _capsuleLen = 0;

   _oddSample = 0;
   _oddData = 0;

   _correlationMagnitude = 0.0;

   _primed = 0;
   _movingSum = 0.0;
   _movingSumIndex = 0;
   for (int i=0; i<2*CODE_LENGTH; ++i)
      _movingSumAddends[i] = 0.0;
}

/*
 * Our virtual destructor.
 */
correlator_cc_impl::~correlator_cc_impl()
{
}

void
correlator_cc_impl::detect_peak(sampleType real, sampleType imag)
{
   static sampleType lastRealOdd = 0;
   static sampleType lastImagOdd = 0;
   static sampleType lastRealEven = 0;
   static sampleType lastImagEven = 0;

   sampleType& lastReal = (_oddSample ? lastRealOdd : lastRealEven);
   sampleType& lastImag = (_oddSample ? lastImagOdd : lastImagEven);

   int& accIndex = (_oddSample ? _accIndexOdd : _accIndexEven);

   sampleType* accRealArr = (_oddSample ? _accRealOdd : _accRealEven);
   sampleType* accImagArr = (_oddSample ? _accImagOdd : _accImagEven);

   sampleType* realPtr = accRealArr + accIndex;
   sampleType* imagPtr = accImagArr + accIndex;

   sampleType a = lastReal;
   sampleType b = lastImag;
   sampleType e = real;
   sampleType f = imag;
   lastReal = real;
   lastImag = imag;

   real = (a*e + f*b) / (a*a + b*b);
   imag = (a*f - e*b) / (a*a + b*b);
   if (isnan(real) || isnan(imag))
   {
      real = imag = 0.0;
   }


   // Zero out the accumulator that is getting its first sample
   accRealArr[accIndex+CODE_LENGTH] = 0;
   accImagArr[accIndex+CODE_LENGTH] = 0;

   *(realPtr + 0) += real;
   *(realPtr + 1) += real;
   *(realPtr + 2) -= real;
   *(realPtr + 3) += real;
   *(realPtr + 4) += real;
   *(realPtr + 5) -= real;
   *(realPtr + 6) -= imag;
   *(realPtr + 7) += real;
   *(realPtr + 8) -= real;
   *(realPtr + 9) -= imag;
   *(realPtr + 10) += real;
   *(realPtr + 11) -= real;
   *(realPtr + 12) += real;
   *(realPtr + 13) -= imag;
   *(realPtr + 14) -= real;
   *(realPtr + 15) -= real;
   *(realPtr + 16) += real;
   *(realPtr + 17) -= real;
   *(realPtr + 18) += real;
   *(realPtr + 19) -= imag;
   *(realPtr + 20) += imag;
   *(realPtr + 21) -= real;
   *(realPtr + 22) -= real;
   *(realPtr + 23) -= imag;
   *(realPtr + 24) += real;
   *(realPtr + 25) += real;
   *(realPtr + 26) += imag;
   *(realPtr + 27) -= imag;
   *(realPtr + 28) += real;
   *(realPtr + 29) -= imag;
   *(realPtr + 30) += real;
   *(realPtr + 31) -= real;
   *(realPtr + 32) -= real;
   *(realPtr + 33) -= real;
   *(realPtr + 34) -= imag;
   *(realPtr + 35) -= real;
   *(realPtr + 36) += real;
   *(realPtr + 37) -= imag;
   *(realPtr + 38) -= real;
   *(realPtr + 39) += imag;
   *(realPtr + 40) += real;
   *(realPtr + 41) -= imag;
   *(realPtr + 42) -= real;
   *(realPtr + 43) -= real;
   *(realPtr + 44) -= real;
   *(realPtr + 45) += real;
   *(realPtr + 46) -= imag;
   *(realPtr + 47) += imag;
   *(realPtr + 48) -= imag;
   *(realPtr + 49) += imag;
   *(realPtr + 50) -= real;
   *(realPtr + 51) -= imag;
   *(realPtr + 52) += real;
   *(realPtr + 53) -= imag;
   *(realPtr + 54) += imag;
   *(realPtr + 55) -= imag;
   *(realPtr + 56) -= real;
   *(realPtr + 57) -= imag;
   *(realPtr + 58) -= real;
   *(realPtr + 59) -= imag;
   *(realPtr + 60) += imag;
   *(realPtr + 61) += real;
   *(realPtr + 62) -= imag;
   *(realPtr + 63) += imag;
   *(realPtr + 64) += real;
   *(realPtr + 65) -= imag;
   *(realPtr + 66) -= imag;
   *(realPtr + 67) -= real;
   *(realPtr + 68) -= real;
   *(realPtr + 69) -= real;
   *(realPtr + 70) -= real;
   *(realPtr + 71) -= real;
   *(realPtr + 72) -= real;
   *(realPtr + 73) -= real;
   *(realPtr + 74) -= real;
   *(realPtr + 75) += imag;
   *(realPtr + 76) += imag;
   *(realPtr + 77) += real;
   *(realPtr + 78) += real;
   *(realPtr + 79) -= real;
   *(realPtr + 80) -= real;
   *(realPtr + 81) -= real;
   *(realPtr + 82) -= imag;
   *(realPtr + 83) += imag;
   *(realPtr + 84) += real;
   *(realPtr + 85) += imag;
   *(realPtr + 86) += imag;
   *(realPtr + 87) += real;
   *(realPtr + 88) -= real;
   *(realPtr + 89) += imag;
   *(realPtr + 90) -= imag;
   *(realPtr + 91) += real;
   *(realPtr + 92) -= real;
   *(realPtr + 93) -= real;
   *(realPtr + 94) += real;
   *(realPtr + 95) -= imag;
   *(realPtr + 96) -= real;
   *(realPtr + 97) += imag;
   *(realPtr + 98) -= real;
   *(realPtr + 99) -= imag;
   *(realPtr + 100) -= imag;
   *(realPtr + 101) -= real;
   *(realPtr + 102) += imag;
   *(realPtr + 103) += real;
   *(realPtr + 104) -= imag;
   *(realPtr + 105) += imag;
   *(realPtr + 106) -= imag;
   *(realPtr + 107) -= real;
   *(realPtr + 108) += real;
   *(realPtr + 109) -= real;
   *(realPtr + 110) -= imag;
   *(realPtr + 111) -= imag;
   *(realPtr + 112) += real;
   *(realPtr + 113) -= imag;
   *(realPtr + 114) += imag;
   *(realPtr + 115) += imag;
   *(realPtr + 116) -= imag;
   *(realPtr + 117) += imag;
   *(realPtr + 118) -= imag;
   *(realPtr + 119) += real;
   *(realPtr + 120) -= real;
   *(realPtr + 121) += real;
   *(realPtr + 122) -= imag;
   *(realPtr + 123) -= real;
   *(realPtr + 124) += real;
   *(realPtr + 125) -= real;
   *(realPtr + 126) += imag;
   *(realPtr + 127) += imag;
   *(realPtr + 128) += imag;
   *(realPtr + 129) -= imag;
   *(realPtr + 130) += real;
   *(realPtr + 131) += real;
   *(realPtr + 132) += imag;
   *(realPtr + 133) += imag;
   *(realPtr + 134) += imag;
   *(realPtr + 135) += imag;
   *(realPtr + 136) -= real;
   *(realPtr + 137) -= imag;
   *(realPtr + 138) += imag;
   *(realPtr + 139) -= real;
   *(realPtr + 140) -= imag;
   *(realPtr + 141) += imag;
   *(realPtr + 142) -= real;
   *(realPtr + 143) += imag;
   *(realPtr + 144) -= real;
   *(realPtr + 145) += real;
   *(realPtr + 146) -= real;
   *(realPtr + 147) += real;
   *(realPtr + 148) -= real;
   *(realPtr + 149) += real;
   *(realPtr + 150) -= real;
   *(realPtr + 151) -= imag;
   *(realPtr + 152) -= real;
   *(realPtr + 153) -= imag;
   *(realPtr + 154) -= real;
   *(realPtr + 155) -= real;
   *(realPtr + 156) += real;
   *(realPtr + 157) -= real;
   *(realPtr + 158) -= imag;
   *(realPtr + 159) += real;
   *(realPtr + 160) += imag;
   *(realPtr + 161) -= imag;
   *(realPtr + 162) -= real;
   *(realPtr + 163) -= imag;
   *(realPtr + 164) -= real;
   *(realPtr + 165) -= imag;
   *(realPtr + 166) -= real;
   *(realPtr + 167) += imag;
   *(realPtr + 168) += real;
   *(realPtr + 169) -= real;
   *(realPtr + 170) += real;
   *(realPtr + 171) -= imag;
   *(realPtr + 172) += imag;
   *(realPtr + 173) += imag;
   *(realPtr + 174) -= imag;
   *(realPtr + 175) -= imag;
   *(realPtr + 176) += real;
   *(realPtr + 177) -= imag;
   *(realPtr + 178) -= imag;
   *(realPtr + 179) -= imag;
   *(realPtr + 180) += imag;
   *(realPtr + 181) += real;
   *(realPtr + 182) -= real;
   *(realPtr + 183) += imag;
   *(realPtr + 184) -= real;
   *(realPtr + 185) -= real;
   *(realPtr + 186) -= imag;
   *(realPtr + 187) += real;
   *(realPtr + 188) -= imag;
   *(realPtr + 189) += imag;
   *(realPtr + 190) -= real;
   *(realPtr + 191) -= real;
   *(realPtr + 192) += real;
   *(realPtr + 193) -= real;
   *(realPtr + 194) += real;
   *(realPtr + 195) -= imag;
   *(realPtr + 196) -= real;
   *(realPtr + 197) += real;
   *(realPtr + 198) -= imag;
   *(realPtr + 199) += imag;
   *(realPtr + 200) -= real;
   *(realPtr + 201) -= real;
   *(realPtr + 202) -= imag;
   *(realPtr + 203) += real;
   *(realPtr + 204) -= real;
   *(realPtr + 205) -= real;
   *(realPtr + 206) -= imag;
   *(realPtr + 207) -= real;
   *(realPtr + 208) += imag;
   *(realPtr + 209) -= real;
   *(realPtr + 210) += real;
   *(realPtr + 211) += real;
   *(realPtr + 212) -= imag;
   *(realPtr + 213) -= imag;
   *(realPtr + 214) -= real;
   *(realPtr + 215) += imag;
   *(realPtr + 216) += imag;
   *(realPtr + 217) += real;
   *(realPtr + 218) -= imag;
   *(realPtr + 219) -= imag;
   *(realPtr + 220) += imag;
   *(realPtr + 221) -= real;
   *(realPtr + 222) -= real;
   *(realPtr + 223) += real;
   *(realPtr + 224) += real;
   *(realPtr + 225) -= real;
   *(realPtr + 226) -= real;
   *(realPtr + 227) -= imag;
   *(realPtr + 228) += imag;
   *(realPtr + 229) += imag;
   *(realPtr + 230) += imag;
   *(realPtr + 231) -= real;
   *(realPtr + 232) += real;
   *(realPtr + 233) += real;
   *(realPtr + 234) += imag;
   *(realPtr + 235) -= imag;
   *(realPtr + 236) += imag;
   *(realPtr + 237) -= real;
   *(realPtr + 238) -= imag;
   *(realPtr + 239) -= imag;
   *(realPtr + 240) -= imag;
   *(realPtr + 241) -= imag;
   *(realPtr + 242) += imag;
   *(realPtr + 243) += imag;
   *(realPtr + 244) -= imag;
   *(realPtr + 245) -= real;
   *(realPtr + 246) += real;
   *(realPtr + 247) -= imag;
   *(realPtr + 248) += real;
   *(realPtr + 249) += real;
   *(realPtr + 250) -= real;
   *(realPtr + 251) += real;
   *(realPtr + 252) += imag;
   *(realPtr + 253) -= imag;
   *(realPtr + 254) -= real;
   *(realPtr + 255) -= real;
   *(realPtr + 256) += real;
   *(realPtr + 257) -= imag;
   *(realPtr + 258) -= real;
   *(realPtr + 259) -= imag;
   *(realPtr + 260) += imag;
   *(realPtr + 261) -= real;
   *(realPtr + 262) -= imag;
   *(realPtr + 263) += imag;
   *(realPtr + 264) -= imag;
   *(realPtr + 265) -= real;
   *(realPtr + 266) += imag;
   *(realPtr + 267) -= real;
   *(realPtr + 268) += real;
   *(realPtr + 269) += real;
   *(realPtr + 270) -= real;
   *(realPtr + 271) += imag;
   *(realPtr + 272) += imag;
   *(realPtr + 273) -= real;
   *(realPtr + 274) += imag;
   *(realPtr + 275) -= real;
   *(realPtr + 276) -= imag;
   *(realPtr + 277) += real;
   *(realPtr + 278) += imag;
   *(realPtr + 279) -= imag;
   *(realPtr + 280) -= real;
   *(realPtr + 281) += real;
   *(realPtr + 282) += imag;
   *(realPtr + 283) += imag;
   *(realPtr + 284) += imag;
   *(realPtr + 285) += imag;
   *(realPtr + 286) -= real;
   *(realPtr + 287) -= real;
   *(realPtr + 288) += imag;
   *(realPtr + 289) += real;
   *(realPtr + 290) += imag;
   *(realPtr + 291) += imag;
   *(realPtr + 292) -= real;
   *(realPtr + 293) += imag;
   *(realPtr + 294) -= imag;
   *(realPtr + 295) -= real;
   *(realPtr + 296) -= real;
   *(realPtr + 297) -= imag;
   *(realPtr + 298) += real;
   *(realPtr + 299) -= real;
   *(realPtr + 300) -= real;
   *(realPtr + 301) -= real;
   *(realPtr + 302) += real;
   *(realPtr + 303) += imag;
   *(realPtr + 304) -= real;
   *(realPtr + 305) -= real;
   *(realPtr + 306) += real;
   *(realPtr + 307) += imag;
   *(realPtr + 308) -= real;
   *(realPtr + 309) -= real;
   *(realPtr + 310) += imag;
   *(realPtr + 311) += real;
   *(realPtr + 312) -= real;
   *(realPtr + 313) += imag;
   *(realPtr + 314) += imag;
   *(realPtr + 315) += real;
   *(realPtr + 316) += real;
   *(realPtr + 317) -= real;
   *(realPtr + 318) -= real;
   *(realPtr + 319) -= real;
   *(realPtr + 320) += real;
   *(realPtr + 321) -= imag;
   *(realPtr + 322) += real;
   *(realPtr + 323) -= imag;
   *(realPtr + 324) += imag;
   *(realPtr + 325) += real;
   *(realPtr + 326) += real;
   *(realPtr + 327) -= real;
   *(realPtr + 328) += imag;
   *(realPtr + 329) -= real;
   *(realPtr + 330) -= imag;
   *(realPtr + 331) += real;
   *(realPtr + 332) -= real;
   *(realPtr + 333) += imag;
   *(realPtr + 334) += imag;
   *(realPtr + 335) += imag;
   *(realPtr + 336) -= real;
   *(realPtr + 337) -= imag;
   *(realPtr + 338) -= imag;
   *(realPtr + 339) += real;
   *(realPtr + 340) += real;
   *(realPtr + 341) += imag;
   *(realPtr + 342) += imag;
   *(realPtr + 343) -= imag;
   *(realPtr + 344) += real;
   *(realPtr + 345) += real;
   *(realPtr + 346) += real;
   *(realPtr + 347) += imag;
   *(realPtr + 348) += real;
   *(realPtr + 349) += imag;
   *(realPtr + 350) += imag;
   *(realPtr + 351) += imag;
   *(realPtr + 352) += imag;
   *(realPtr + 353) += imag;
   *(realPtr + 354) -= imag;
   *(realPtr + 355) -= real;
   *(realPtr + 356) += imag;
   *(realPtr + 357) -= real;
   *(realPtr + 358) += imag;
   *(realPtr + 359) += real;
   *(realPtr + 360) += real;
   *(realPtr + 361) -= real;
   *(realPtr + 362) -= imag;
   *(realPtr + 363) += real;
   *(realPtr + 364) += imag;
   *(realPtr + 365) += imag;
   *(realPtr + 366) -= imag;
   *(realPtr + 367) += real;
   *(realPtr + 368) -= imag;
   *(realPtr + 369) -= imag;
   *(realPtr + 370) += real;
   *(realPtr + 371) += imag;
   *(realPtr + 372) -= real;
   *(realPtr + 373) -= imag;
   *(realPtr + 374) -= imag;
   *(realPtr + 375) -= real;
   *(realPtr + 376) += real;
   *(realPtr + 377) -= real;
   *(realPtr + 378) += real;
   *(realPtr + 379) -= imag;
   *(realPtr + 380) -= imag;
   *(realPtr + 381) += real;
   *(realPtr + 382) -= real;
   *(realPtr + 383) += imag;
   *(realPtr + 384) -= imag;
   *(realPtr + 385) += real;
   *(realPtr + 386) += imag;
   *(realPtr + 387) += imag;
   *(realPtr + 388) += real;
   *(realPtr + 389) += imag;
   *(realPtr + 390) -= real;
   *(realPtr + 391) += imag;
   *(realPtr + 392) += real;
   *(realPtr + 393) += real;
   *(realPtr + 394) -= real;
   *(realPtr + 395) += real;
   *(realPtr + 396) -= real;
   *(realPtr + 397) += imag;
   *(realPtr + 398) += imag;
   *(realPtr + 399) -= imag;
   *(realPtr + 400) += real;
   *(realPtr + 401) += imag;
   *(realPtr + 402) += real;
   *(realPtr + 403) += real;
   *(realPtr + 404) += imag;
   *(realPtr + 405) += imag;
   *(realPtr + 406) += imag;
   *(realPtr + 407) += imag;
   *(realPtr + 408) += real;
   *(realPtr + 409) += imag;
   *(realPtr + 410) += real;
   *(realPtr + 411) += real;
   *(realPtr + 412) -= imag;
   *(realPtr + 413) -= imag;
   *(realPtr + 414) -= real;
   *(realPtr + 415) -= imag;
   *(realPtr + 416) -= real;
   *(realPtr + 417) += imag;
   *(realPtr + 418) -= real;
   *(realPtr + 419) += real;
   *(realPtr + 420) -= imag;
   *(realPtr + 421) -= real;
   *(realPtr + 422) -= real;
   *(realPtr + 423) += imag;
   *(realPtr + 424) += imag;
   *(realPtr + 425) -= imag;
   *(realPtr + 426) += real;
   *(realPtr + 427) -= real;
   *(realPtr + 428) -= real;
   *(realPtr + 429) += real;
   *(realPtr + 430) += real;
   *(realPtr + 431) += imag;
   *(realPtr + 432) += imag;
   *(realPtr + 433) -= imag;
   *(realPtr + 434) -= imag;
   *(realPtr + 435) -= imag;
   *(realPtr + 436) -= real;
   *(realPtr + 437) -= real;
   *(realPtr + 438) -= imag;
   *(realPtr + 439) -= imag;
   *(realPtr + 440) += imag;
   *(realPtr + 441) += real;
   *(realPtr + 442) += real;
   *(realPtr + 443) += imag;
   *(realPtr + 444) -= imag;
   *(realPtr + 445) -= real;
   *(realPtr + 446) -= imag;
   *(realPtr + 447) += imag;
   *(realPtr + 448) -= imag;
   *(realPtr + 449) -= imag;
   *(realPtr + 450) += real;
   *(realPtr + 451) -= imag;
   *(realPtr + 452) += real;
   *(realPtr + 453) += real;
   *(realPtr + 454) -= real;
   *(realPtr + 455) += imag;
   *(realPtr + 456) -= real;
   *(realPtr + 457) += imag;
   *(realPtr + 458) += real;
   *(realPtr + 459) += imag;
   *(realPtr + 460) += real;
   *(realPtr + 461) -= imag;
   *(realPtr + 462) += imag;
   *(realPtr + 463) += real;
   *(realPtr + 464) += imag;
   *(realPtr + 465) -= imag;
   *(realPtr + 466) -= imag;
   *(realPtr + 467) -= imag;
   *(realPtr + 468) += imag;
   *(realPtr + 469) += real;
   *(realPtr + 470) += real;
   *(realPtr + 471) -= real;
   *(realPtr + 472) -= real;
   *(realPtr + 473) -= imag;
   *(realPtr + 474) -= real;
   *(realPtr + 475) -= real;
   *(realPtr + 476) -= imag;
   *(realPtr + 477) += imag;
   *(realPtr + 478) -= imag;
   *(realPtr + 479) -= real;
   *(realPtr + 480) += imag;
   *(realPtr + 481) += real;
   *(realPtr + 482) += real;
   *(realPtr + 483) -= real;
   *(realPtr + 484) -= imag;
   *(realPtr + 485) += imag;
   *(realPtr + 486) += imag;
   *(realPtr + 487) += real;
   *(realPtr + 488) -= imag;
   *(realPtr + 489) -= real;
   *(realPtr + 490) -= imag;
   *(realPtr + 491) -= imag;
   *(realPtr + 492) -= imag;
   *(realPtr + 493) -= imag;
   *(realPtr + 494) -= imag;
   *(realPtr + 495) += real;
   *(realPtr + 496) -= imag;
   *(realPtr + 497) -= imag;
   *(realPtr + 498) += real;
   *(realPtr + 499) += imag;
   *(realPtr + 500) += real;
   *(realPtr + 501) += real;
   *(realPtr + 502) += imag;
   *(realPtr + 503) += real;
   *(realPtr + 504) -= real;
   *(realPtr + 505) += real;
   *(realPtr + 506) += real;
   *(realPtr + 507) -= imag;
   *(realPtr + 508) += real;
   *(realPtr + 509) -= real;
   *(realPtr + 510) += real;
   *(realPtr + 511) += real;
   *(realPtr + 512) -= imag;
   *(realPtr + 513) += real;
   *(realPtr + 514) += imag;
   *(realPtr + 515) -= real;
   *(realPtr + 516) += real;
   *(realPtr + 517) -= imag;
   *(realPtr + 518) -= real;
   *(realPtr + 519) += imag;
   *(realPtr + 520) -= real;
   *(realPtr + 521) -= imag;
   *(realPtr + 522) -= imag;
   *(realPtr + 523) -= real;
   *(realPtr + 524) += real;
   *(realPtr + 525) -= real;
   *(realPtr + 526) -= imag;
   *(realPtr + 527) += imag;
   *(realPtr + 528) += imag;
   *(realPtr + 529) += real;
   *(realPtr + 530) += real;
   *(realPtr + 531) += imag;
   *(realPtr + 532) += imag;
   *(realPtr + 533) += imag;
   *(realPtr + 534) -= imag;
   *(realPtr + 535) += imag;
   *(realPtr + 536) += imag;
   *(realPtr + 537) -= imag;
   *(realPtr + 538) -= real;
   *(realPtr + 539) += imag;
   *(realPtr + 540) -= imag;
   *(realPtr + 541) += real;
   *(realPtr + 542) += real;
   *(realPtr + 543) -= real;
   *(realPtr + 544) -= real;
   *(realPtr + 545) -= imag;
   *(realPtr + 546) -= real;
   *(realPtr + 547) -= real;
   *(realPtr + 548) += real;
   *(realPtr + 549) += imag;
   *(realPtr + 550) -= imag;
   *(realPtr + 551) += real;
   *(realPtr + 552) += imag;
   *(realPtr + 553) += real;
   *(realPtr + 554) -= real;
   *(realPtr + 555) += imag;
   *(realPtr + 556) += imag;
   *(realPtr + 557) += imag;
   *(realPtr + 558) += real;
   *(realPtr + 559) += real;
   *(realPtr + 560) += imag;
   *(realPtr + 561) += real;
   *(realPtr + 562) -= real;
   *(realPtr + 563) -= imag;
   *(realPtr + 564) += imag;
   *(realPtr + 565) -= imag;
   *(realPtr + 566) -= imag;
   *(realPtr + 567) -= real;
   *(realPtr + 568) -= real;
   *(realPtr + 569) += real;
   *(realPtr + 570) += real;
   *(realPtr + 571) -= imag;
   *(realPtr + 572) += imag;
   *(realPtr + 573) -= real;
   *(realPtr + 574) += imag;
   *(realPtr + 575) -= imag;
   *(realPtr + 576) -= imag;
   *(realPtr + 577) -= real;
   *(realPtr + 578) += imag;
   *(realPtr + 579) -= imag;
   *(realPtr + 580) -= real;
   *(realPtr + 581) += real;
   *(realPtr + 582) += real;
   *(realPtr + 583) -= imag;
   *(realPtr + 584) += imag;
   *(realPtr + 585) += real;
   *(realPtr + 586) -= real;
   *(realPtr + 587) -= real;
   *(realPtr + 588) += imag;
   *(realPtr + 589) += imag;
   *(realPtr + 590) -= imag;
   *(realPtr + 591) -= imag;
   *(realPtr + 592) += real;
   *(realPtr + 593) -= imag;
   *(realPtr + 594) -= imag;
   *(realPtr + 595) -= imag;
   *(realPtr + 596) -= imag;
   *(realPtr + 597) -= imag;
   *(realPtr + 598) -= real;
   *(realPtr + 599) -= imag;
   *(realPtr + 600) += real;
   *(realPtr + 601) += real;
   *(realPtr + 602) += imag;
   *(realPtr + 603) += real;
   *(realPtr + 604) -= real;
   *(realPtr + 605) -= imag;
   *(realPtr + 606) -= real;
   *(realPtr + 607) += imag;
   *(realPtr + 608) += real;
   *(realPtr + 609) += real;
   *(realPtr + 610) -= real;
   *(realPtr + 611) += real;
   *(realPtr + 612) -= real;
   *(realPtr + 613) -= real;
   *(realPtr + 614) -= imag;
   *(realPtr + 615) -= imag;
   *(realPtr + 616) += real;
   *(realPtr + 617) += imag;
   *(realPtr + 618) += real;
   *(realPtr + 619) += real;
   *(realPtr + 620) -= real;
   *(realPtr + 621) -= imag;
   *(realPtr + 622) -= imag;
   *(realPtr + 623) += real;
   *(realPtr + 624) -= real;
   *(realPtr + 625) += imag;
   *(realPtr + 626) += real;
   *(realPtr + 627) -= imag;
   *(realPtr + 628) += imag;
   *(realPtr + 629) += imag;
   *(realPtr + 630) += real;
   *(realPtr + 631) += imag;
   *(realPtr + 632) -= real;
   *(realPtr + 633) += real;
   *(realPtr + 634) += imag;
   *(realPtr + 635) += real;
   *(realPtr + 636) -= imag;
   *(realPtr + 637) -= imag;
   *(realPtr + 638) -= real;
   *(realPtr + 639) -= imag;
   *(realPtr + 640) -= real;
   *(realPtr + 641) += real;
   *(realPtr + 642) -= real;
   *(realPtr + 643) -= imag;
   *(realPtr + 644) += real;
   *(realPtr + 645) -= real;
   *(realPtr + 646) -= real;
   *(realPtr + 647) += imag;
   *(realPtr + 648) += real;
   *(realPtr + 649) -= imag;
   *(realPtr + 650) -= imag;
   *(realPtr + 651) += real;
   *(realPtr + 652) += real;
   *(realPtr + 653) -= imag;
   *(realPtr + 654) -= imag;
   *(realPtr + 655) -= real;
   *(realPtr + 656) += imag;
   *(realPtr + 657) -= real;
   *(realPtr + 658) -= real;
   *(realPtr + 659) += imag;
   *(realPtr + 660) -= real;
   *(realPtr + 661) -= imag;
   *(realPtr + 662) -= real;
   *(realPtr + 663) += real;
   *(realPtr + 664) += imag;
   *(realPtr + 665) += real;
   *(realPtr + 666) += real;
   *(realPtr + 667) += real;
   *(realPtr + 668) -= imag;
   *(realPtr + 669) += imag;
   *(realPtr + 670) -= real;
   *(realPtr + 671) += real;
   *(realPtr + 672) += real;
   *(realPtr + 673) -= real;
   *(realPtr + 674) -= imag;
   *(realPtr + 675) -= imag;
   *(realPtr + 676) -= imag;
   *(realPtr + 677) -= real;
   *(realPtr + 678) += imag;
   *(realPtr + 679) += imag;
   *(realPtr + 680) += real;
   *(realPtr + 681) += imag;
   *(realPtr + 682) += imag;
   *(realPtr + 683) += imag;
   *(realPtr + 684) += imag;
   *(realPtr + 685) += real;
   *(realPtr + 686) += real;
   *(realPtr + 687) -= real;
   *(realPtr + 688) -= real;
   *(realPtr + 689) += real;
   *(realPtr + 690) += imag;
   *(realPtr + 691) += real;
   *(realPtr + 692) += imag;
   *(realPtr + 693) -= imag;
   *(realPtr + 694) += imag;
   *(realPtr + 695) += real;
   *(realPtr + 696) += real;
   *(realPtr + 697) += imag;
   *(realPtr + 698) -= real;
   *(realPtr + 699) += imag;
   *(realPtr + 700) += real;
   *(realPtr + 701) += imag;
   *(realPtr + 702) += imag;
   *(realPtr + 703) -= imag;
   *(realPtr + 704) -= real;
   *(realPtr + 705) += real;
   *(realPtr + 706) += imag;
   *(realPtr + 707) -= imag;
   *(realPtr + 708) -= imag;
   *(realPtr + 709) += real;
   *(realPtr + 710) -= imag;
   *(realPtr + 711) += imag;
   *(realPtr + 712) -= imag;
   *(realPtr + 713) += real;
   *(realPtr + 714) -= imag;
   *(realPtr + 715) -= imag;
   *(realPtr + 716) += imag;
   *(realPtr + 717) -= real;
   *(realPtr + 718) -= real;
   *(realPtr + 719) -= imag;
   *(realPtr + 720) -= imag;
   *(realPtr + 721) -= real;
   *(realPtr + 722) += real;
   *(realPtr + 723) += imag;
   *(realPtr + 724) += imag;
   *(realPtr + 725) -= imag;
   *(realPtr + 726) -= real;
   *(realPtr + 727) -= imag;
   *(realPtr + 728) -= real;
   *(realPtr + 729) += imag;
   *(realPtr + 730) += real;
   *(realPtr + 731) += imag;
   *(realPtr + 732) += imag;
   *(realPtr + 733) -= imag;
   *(realPtr + 734) += real;
   *(realPtr + 735) += imag;
   *(realPtr + 736) += imag;
   *(realPtr + 737) += imag;
   *(realPtr + 738) += imag;
   *(realPtr + 739) -= real;
   *(realPtr + 740) += imag;
   *(realPtr + 741) += imag;
   *(realPtr + 742) += real;
   *(realPtr + 743) += real;
   *(realPtr + 744) -= imag;
   *(realPtr + 745) -= real;
   *(realPtr + 746) += imag;
   *(realPtr + 747) -= real;
   *(realPtr + 748) -= real;
   *(realPtr + 749) -= real;
   *(realPtr + 750) -= imag;
   *(realPtr + 751) -= real;
   *(realPtr + 752) -= real;
   *(realPtr + 753) += imag;
   *(realPtr + 754) += imag;
   *(realPtr + 755) += real;
   *(realPtr + 756) += imag;
   *(realPtr + 757) -= imag;
   *(realPtr + 758) -= real;
   *(realPtr + 759) -= real;
   *(realPtr + 760) += real;
   *(realPtr + 761) += imag;
   *(realPtr + 762) += real;
   *(realPtr + 763) += real;
   *(realPtr + 764) -= real;
   *(realPtr + 765) += real;
   *(realPtr + 766) -= imag;
   *(realPtr + 767) -= imag;
   *(realPtr + 768) += imag;
   *(realPtr + 769) -= real;
   *(realPtr + 770) -= real;
   *(realPtr + 771) -= imag;
   *(realPtr + 772) -= real;
   *(realPtr + 773) += imag;
   *(realPtr + 774) += imag;
   *(realPtr + 775) += imag;
   *(realPtr + 776) -= imag;
   *(realPtr + 777) += imag;
   *(realPtr + 778) += real;
   *(realPtr + 779) += real;
   *(realPtr + 780) += imag;
   *(realPtr + 781) -= real;
   *(realPtr + 782) += imag;
   *(realPtr + 783) -= real;
   *(realPtr + 784) -= real;
   *(realPtr + 785) += imag;
   *(realPtr + 786) -= imag;
   *(realPtr + 787) += real;
   *(realPtr + 788) += real;
   *(realPtr + 789) += imag;
   *(realPtr + 790) -= imag;
   *(realPtr + 791) -= real;
   *(realPtr + 792) -= real;
   *(realPtr + 793) -= imag;
   *(realPtr + 794) += real;
   *(realPtr + 795) += imag;
   *(realPtr + 796) -= real;
   *(realPtr + 797) += imag;
   *(realPtr + 798) -= real;
   *(realPtr + 799) += imag;
   *(realPtr + 800) += real;
   *(realPtr + 801) += real;
   *(realPtr + 802) += imag;
   *(realPtr + 803) += imag;
   *(realPtr + 804) += imag;
   *(realPtr + 805) += imag;
   *(realPtr + 806) += imag;
   *(realPtr + 807) -= imag;
   *(realPtr + 808) += real;
   *(realPtr + 809) -= real;
   *(realPtr + 810) += imag;
   *(realPtr + 811) -= imag;
   *(realPtr + 812) -= real;
   *(realPtr + 813) -= real;
   *(realPtr + 814) += real;
   *(realPtr + 815) += imag;
   *(realPtr + 816) += imag;
   *(realPtr + 817) += real;
   *(realPtr + 818) += imag;
   *(realPtr + 819) += real;
   *(realPtr + 820) -= imag;
   *(realPtr + 821) += imag;
   *(realPtr + 822) += imag;
   *(realPtr + 823) -= imag;
   *(realPtr + 824) += real;
   *(realPtr + 825) -= real;
   *(realPtr + 826) -= imag;
   *(realPtr + 827) += imag;
   *(realPtr + 828) -= real;
   *(realPtr + 829) -= imag;
   *(realPtr + 830) += real;
   *(realPtr + 831) -= imag;
   *(realPtr + 832) += imag;
   *(realPtr + 833) -= real;
   *(realPtr + 834) -= imag;
   *(realPtr + 835) += real;
   *(realPtr + 836) -= real;
   *(realPtr + 837) += imag;
   *(realPtr + 838) -= imag;
   *(realPtr + 839) -= real;
   *(realPtr + 840) -= real;
   *(realPtr + 841) += real;
   *(realPtr + 842) -= imag;
   *(realPtr + 843) += real;
   *(realPtr + 844) -= real;
   *(realPtr + 845) += imag;
   *(realPtr + 846) -= real;
   *(realPtr + 847) -= imag;
   *(realPtr + 848) -= imag;
   *(realPtr + 849) -= imag;
   *(realPtr + 850) -= real;
   *(realPtr + 851) -= real;
   *(realPtr + 852) += real;
   *(realPtr + 853) -= real;
   *(realPtr + 854) += imag;
   *(realPtr + 855) += real;
   *(realPtr + 856) -= imag;
   *(realPtr + 857) += imag;
   *(realPtr + 858) += imag;
   *(realPtr + 859) += imag;
   *(realPtr + 860) -= real;
   *(realPtr + 861) -= imag;
   *(realPtr + 862) += real;
   *(realPtr + 863) += imag;
   *(realPtr + 864) += real;
   *(realPtr + 865) -= imag;
   *(realPtr + 866) += real;
   *(realPtr + 867) += imag;
   *(realPtr + 868) -= real;
   *(realPtr + 869) -= imag;
   *(realPtr + 870) -= imag;
   *(realPtr + 871) += imag;
   *(realPtr + 872) += imag;
   *(realPtr + 873) += imag;
   *(realPtr + 874) -= imag;
   *(realPtr + 875) -= imag;
   *(realPtr + 876) -= imag;
   *(realPtr + 877) -= real;
   *(realPtr + 878) += imag;
   *(realPtr + 879) -= real;
   *(realPtr + 880) += real;
   *(realPtr + 881) += real;
   *(realPtr + 882) -= real;
   *(realPtr + 883) -= real;
   *(realPtr + 884) -= imag;
   *(realPtr + 885) -= real;
   *(realPtr + 886) -= imag;
   *(realPtr + 887) += real;
   *(realPtr + 888) += imag;
   *(realPtr + 889) -= real;
   *(realPtr + 890) += real;
   *(realPtr + 891) -= imag;
   *(realPtr + 892) += real;
   *(realPtr + 893) -= imag;
   *(realPtr + 894) += imag;
   *(realPtr + 895) -= imag;
   *(realPtr + 896) += imag;
   *(realPtr + 897) -= real;
   *(realPtr + 898) -= real;
   *(realPtr + 899) += real;
   *(realPtr + 900) -= imag;
   *(realPtr + 901) -= real;
   *(realPtr + 902) -= imag;
   *(realPtr + 903) += real;
   *(realPtr + 904) += imag;
   *(realPtr + 905) += imag;
   *(realPtr + 906) -= imag;
   *(realPtr + 907) += imag;
   *(realPtr + 908) += real;
   *(realPtr + 909) -= imag;
   *(realPtr + 910) -= imag;
   *(realPtr + 911) -= imag;
   *(realPtr + 912) -= real;
   *(realPtr + 913) -= imag;
   *(realPtr + 914) -= real;
   *(realPtr + 915) += imag;
   *(realPtr + 916) -= real;
   *(realPtr + 917) += real;
   *(realPtr + 918) -= imag;
   *(realPtr + 919) += imag;
   *(realPtr + 920) += real;
   *(realPtr + 921) += imag;
   *(realPtr + 922) -= imag;
   *(realPtr + 923) -= imag;
   *(realPtr + 924) += real;
   *(realPtr + 925) -= real;
   *(realPtr + 926) -= imag;
   *(realPtr + 927) += real;
   *(realPtr + 928) -= real;
   *(realPtr + 929) -= real;
   *(realPtr + 930) -= imag;
   *(realPtr + 931) += imag;
   *(realPtr + 932) -= imag;
   *(realPtr + 933) += real;
   *(realPtr + 934) += real;
   *(realPtr + 935) -= real;
   *(realPtr + 936) -= imag;
   *(realPtr + 937) -= imag;
   *(realPtr + 938) += imag;
   *(realPtr + 939) -= imag;
   *(realPtr + 940) += imag;
   *(realPtr + 941) -= imag;
   *(realPtr + 942) += imag;
   *(realPtr + 943) -= imag;
   *(realPtr + 944) += imag;
   *(realPtr + 945) += imag;
   *(realPtr + 946) -= real;
   *(realPtr + 947) += real;
   *(realPtr + 948) -= real;
   *(realPtr + 949) -= real;
   *(realPtr + 950) += real;
   *(realPtr + 951) -= real;
   *(realPtr + 952) -= real;
   *(realPtr + 953) += imag;
   *(realPtr + 954) += imag;
   *(realPtr + 955) += imag;
   *(realPtr + 956) -= real;
   *(realPtr + 957) -= real;
   *(realPtr + 958) -= real;
   *(realPtr + 959) += real;
   *(realPtr + 960) += imag;
   *(realPtr + 961) += imag;
   *(realPtr + 962) += imag;
   *(realPtr + 963) -= imag;
   *(realPtr + 964) += imag;
   *(realPtr + 965) -= imag;
   *(realPtr + 966) += real;
   *(realPtr + 967) -= imag;
   *(realPtr + 968) += imag;
   *(realPtr + 969) -= imag;
   *(realPtr + 970) -= real;
   *(realPtr + 971) += real;
   *(realPtr + 972) -= real;
   *(realPtr + 973) += imag;
   *(realPtr + 974) -= real;
   *(realPtr + 975) += real;
   *(realPtr + 976) -= imag;
   *(realPtr + 977) -= imag;
   *(realPtr + 978) -= imag;
   *(realPtr + 979) += imag;
   *(realPtr + 980) -= imag;
   *(realPtr + 981) += real;
   *(realPtr + 982) -= real;
   *(realPtr + 983) += real;
   *(realPtr + 984) -= imag;
   *(realPtr + 985) += imag;
   *(realPtr + 986) += real;
   *(realPtr + 987) += real;
   *(realPtr + 988) -= imag;
   *(realPtr + 989) -= imag;
   *(realPtr + 990) += imag;
   *(realPtr + 991) += imag;
   *(realPtr + 992) -= imag;
   *(realPtr + 993) += real;
   *(realPtr + 994) -= imag;
   *(realPtr + 995) += real;
   *(realPtr + 996) += imag;
   *(realPtr + 997) -= imag;
   *(realPtr + 998) -= real;
   *(realPtr + 999) += real;
   *(realPtr + 1000) += imag;
   *(realPtr + 1001) += real;
   *(realPtr + 1002) += imag;
   *(realPtr + 1003) += imag;
   *(realPtr + 1004) += real;
   *(realPtr + 1005) -= real;
   *(realPtr + 1006) -= imag;
   *(realPtr + 1007) += real;
   *(realPtr + 1008) += real;
   *(realPtr + 1009) += imag;
   *(realPtr + 1010) += real;
   *(realPtr + 1011) += real;
   *(realPtr + 1012) += imag;
   *(realPtr + 1013) += real;
   *(realPtr + 1014) += real;
   *(realPtr + 1015) += real;
   *(realPtr + 1016) += real;
   *(realPtr + 1017) += real;
   *(realPtr + 1018) += real;
   *(realPtr + 1019) += real;
   *(realPtr + 1020) += real;
   *(realPtr + 1021) += real;

   *(imagPtr + 0) += imag;
   *(imagPtr + 1) += imag;
   *(imagPtr + 2) -= imag;
   *(imagPtr + 3) += imag;
   *(imagPtr + 4) += imag;
   *(imagPtr + 5) -= imag;
   *(imagPtr + 6) += real;
   *(imagPtr + 7) += imag;
   *(imagPtr + 8) -= imag;
   *(imagPtr + 9) += real;
   *(imagPtr + 10) += imag;
   *(imagPtr + 11) -= imag;
   *(imagPtr + 12) += imag;
   *(imagPtr + 13) += real;
   *(imagPtr + 14) -= imag;
   *(imagPtr + 15) -= imag;
   *(imagPtr + 16) += imag;
   *(imagPtr + 17) -= imag;
   *(imagPtr + 18) += imag;
   *(imagPtr + 19) += real;
   *(imagPtr + 20) -= real;
   *(imagPtr + 21) -= imag;
   *(imagPtr + 22) -= imag;
   *(imagPtr + 23) += real;
   *(imagPtr + 24) += imag;
   *(imagPtr + 25) += imag;
   *(imagPtr + 26) -= real;
   *(imagPtr + 27) += real;
   *(imagPtr + 28) += imag;
   *(imagPtr + 29) += real;
   *(imagPtr + 30) += imag;
   *(imagPtr + 31) -= imag;
   *(imagPtr + 32) -= imag;
   *(imagPtr + 33) -= imag;
   *(imagPtr + 34) += real;
   *(imagPtr + 35) -= imag;
   *(imagPtr + 36) += imag;
   *(imagPtr + 37) += real;
   *(imagPtr + 38) -= imag;
   *(imagPtr + 39) -= real;
   *(imagPtr + 40) += imag;
   *(imagPtr + 41) += real;
   *(imagPtr + 42) -= imag;
   *(imagPtr + 43) -= imag;
   *(imagPtr + 44) -= imag;
   *(imagPtr + 45) += imag;
   *(imagPtr + 46) += real;
   *(imagPtr + 47) -= real;
   *(imagPtr + 48) += real;
   *(imagPtr + 49) -= real;
   *(imagPtr + 50) -= imag;
   *(imagPtr + 51) += real;
   *(imagPtr + 52) += imag;
   *(imagPtr + 53) += real;
   *(imagPtr + 54) -= real;
   *(imagPtr + 55) += real;
   *(imagPtr + 56) -= imag;
   *(imagPtr + 57) += real;
   *(imagPtr + 58) -= imag;
   *(imagPtr + 59) += real;
   *(imagPtr + 60) -= real;
   *(imagPtr + 61) += imag;
   *(imagPtr + 62) += real;
   *(imagPtr + 63) -= real;
   *(imagPtr + 64) += imag;
   *(imagPtr + 65) += real;
   *(imagPtr + 66) += real;
   *(imagPtr + 67) -= imag;
   *(imagPtr + 68) -= imag;
   *(imagPtr + 69) -= imag;
   *(imagPtr + 70) -= imag;
   *(imagPtr + 71) -= imag;
   *(imagPtr + 72) -= imag;
   *(imagPtr + 73) -= imag;
   *(imagPtr + 74) -= imag;
   *(imagPtr + 75) -= real;
   *(imagPtr + 76) -= real;
   *(imagPtr + 77) += imag;
   *(imagPtr + 78) += imag;
   *(imagPtr + 79) -= imag;
   *(imagPtr + 80) -= imag;
   *(imagPtr + 81) -= imag;
   *(imagPtr + 82) += real;
   *(imagPtr + 83) -= real;
   *(imagPtr + 84) += imag;
   *(imagPtr + 85) -= real;
   *(imagPtr + 86) -= real;
   *(imagPtr + 87) += imag;
   *(imagPtr + 88) -= imag;
   *(imagPtr + 89) -= real;
   *(imagPtr + 90) += real;
   *(imagPtr + 91) += imag;
   *(imagPtr + 92) -= imag;
   *(imagPtr + 93) -= imag;
   *(imagPtr + 94) += imag;
   *(imagPtr + 95) += real;
   *(imagPtr + 96) -= imag;
   *(imagPtr + 97) -= real;
   *(imagPtr + 98) -= imag;
   *(imagPtr + 99) += real;
   *(imagPtr + 100) += real;
   *(imagPtr + 101) -= imag;
   *(imagPtr + 102) -= real;
   *(imagPtr + 103) += imag;
   *(imagPtr + 104) += real;
   *(imagPtr + 105) -= real;
   *(imagPtr + 106) += real;
   *(imagPtr + 107) -= imag;
   *(imagPtr + 108) += imag;
   *(imagPtr + 109) -= imag;
   *(imagPtr + 110) += real;
   *(imagPtr + 111) += real;
   *(imagPtr + 112) += imag;
   *(imagPtr + 113) += real;
   *(imagPtr + 114) -= real;
   *(imagPtr + 115) -= real;
   *(imagPtr + 116) += real;
   *(imagPtr + 117) -= real;
   *(imagPtr + 118) += real;
   *(imagPtr + 119) += imag;
   *(imagPtr + 120) -= imag;
   *(imagPtr + 121) += imag;
   *(imagPtr + 122) += real;
   *(imagPtr + 123) -= imag;
   *(imagPtr + 124) += imag;
   *(imagPtr + 125) -= imag;
   *(imagPtr + 126) -= real;
   *(imagPtr + 127) -= real;
   *(imagPtr + 128) -= real;
   *(imagPtr + 129) += real;
   *(imagPtr + 130) += imag;
   *(imagPtr + 131) += imag;
   *(imagPtr + 132) -= real;
   *(imagPtr + 133) -= real;
   *(imagPtr + 134) -= real;
   *(imagPtr + 135) -= real;
   *(imagPtr + 136) -= imag;
   *(imagPtr + 137) += real;
   *(imagPtr + 138) -= real;
   *(imagPtr + 139) -= imag;
   *(imagPtr + 140) += real;
   *(imagPtr + 141) -= real;
   *(imagPtr + 142) -= imag;
   *(imagPtr + 143) -= real;
   *(imagPtr + 144) -= imag;
   *(imagPtr + 145) += imag;
   *(imagPtr + 146) -= imag;
   *(imagPtr + 147) += imag;
   *(imagPtr + 148) -= imag;
   *(imagPtr + 149) += imag;
   *(imagPtr + 150) -= imag;
   *(imagPtr + 151) += real;
   *(imagPtr + 152) -= imag;
   *(imagPtr + 153) += real;
   *(imagPtr + 154) -= imag;
   *(imagPtr + 155) -= imag;
   *(imagPtr + 156) += imag;
   *(imagPtr + 157) -= imag;
   *(imagPtr + 158) += real;
   *(imagPtr + 159) += imag;
   *(imagPtr + 160) -= real;
   *(imagPtr + 161) += real;
   *(imagPtr + 162) -= imag;
   *(imagPtr + 163) += real;
   *(imagPtr + 164) -= imag;
   *(imagPtr + 165) += real;
   *(imagPtr + 166) -= imag;
   *(imagPtr + 167) -= real;
   *(imagPtr + 168) += imag;
   *(imagPtr + 169) -= imag;
   *(imagPtr + 170) += imag;
   *(imagPtr + 171) += real;
   *(imagPtr + 172) -= real;
   *(imagPtr + 173) -= real;
   *(imagPtr + 174) += real;
   *(imagPtr + 175) += real;
   *(imagPtr + 176) += imag;
   *(imagPtr + 177) += real;
   *(imagPtr + 178) += real;
   *(imagPtr + 179) += real;
   *(imagPtr + 180) -= real;
   *(imagPtr + 181) += imag;
   *(imagPtr + 182) -= imag;
   *(imagPtr + 183) -= real;
   *(imagPtr + 184) -= imag;
   *(imagPtr + 185) -= imag;
   *(imagPtr + 186) += real;
   *(imagPtr + 187) += imag;
   *(imagPtr + 188) += real;
   *(imagPtr + 189) -= real;
   *(imagPtr + 190) -= imag;
   *(imagPtr + 191) -= imag;
   *(imagPtr + 192) += imag;
   *(imagPtr + 193) -= imag;
   *(imagPtr + 194) += imag;
   *(imagPtr + 195) += real;
   *(imagPtr + 196) -= imag;
   *(imagPtr + 197) += imag;
   *(imagPtr + 198) += real;
   *(imagPtr + 199) -= real;
   *(imagPtr + 200) -= imag;
   *(imagPtr + 201) -= imag;
   *(imagPtr + 202) += real;
   *(imagPtr + 203) += imag;
   *(imagPtr + 204) -= imag;
   *(imagPtr + 205) -= imag;
   *(imagPtr + 206) += real;
   *(imagPtr + 207) -= imag;
   *(imagPtr + 208) -= real;
   *(imagPtr + 209) -= imag;
   *(imagPtr + 210) += imag;
   *(imagPtr + 211) += imag;
   *(imagPtr + 212) += real;
   *(imagPtr + 213) += real;
   *(imagPtr + 214) -= imag;
   *(imagPtr + 215) -= real;
   *(imagPtr + 216) -= real;
   *(imagPtr + 217) += imag;
   *(imagPtr + 218) += real;
   *(imagPtr + 219) += real;
   *(imagPtr + 220) -= real;
   *(imagPtr + 221) -= imag;
   *(imagPtr + 222) -= imag;
   *(imagPtr + 223) += imag;
   *(imagPtr + 224) += imag;
   *(imagPtr + 225) -= imag;
   *(imagPtr + 226) -= imag;
   *(imagPtr + 227) += real;
   *(imagPtr + 228) -= real;
   *(imagPtr + 229) -= real;
   *(imagPtr + 230) -= real;
   *(imagPtr + 231) -= imag;
   *(imagPtr + 232) += imag;
   *(imagPtr + 233) += imag;
   *(imagPtr + 234) -= real;
   *(imagPtr + 235) += real;
   *(imagPtr + 236) -= real;
   *(imagPtr + 237) -= imag;
   *(imagPtr + 238) += real;
   *(imagPtr + 239) += real;
   *(imagPtr + 240) += real;
   *(imagPtr + 241) += real;
   *(imagPtr + 242) -= real;
   *(imagPtr + 243) -= real;
   *(imagPtr + 244) += real;
   *(imagPtr + 245) -= imag;
   *(imagPtr + 246) += imag;
   *(imagPtr + 247) += real;
   *(imagPtr + 248) += imag;
   *(imagPtr + 249) += imag;
   *(imagPtr + 250) -= imag;
   *(imagPtr + 251) += imag;
   *(imagPtr + 252) -= real;
   *(imagPtr + 253) += real;
   *(imagPtr + 254) -= imag;
   *(imagPtr + 255) -= imag;
   *(imagPtr + 256) += imag;
   *(imagPtr + 257) += real;
   *(imagPtr + 258) -= imag;
   *(imagPtr + 259) += real;
   *(imagPtr + 260) -= real;
   *(imagPtr + 261) -= imag;
   *(imagPtr + 262) += real;
   *(imagPtr + 263) -= real;
   *(imagPtr + 264) += real;
   *(imagPtr + 265) -= imag;
   *(imagPtr + 266) -= real;
   *(imagPtr + 267) -= imag;
   *(imagPtr + 268) += imag;
   *(imagPtr + 269) += imag;
   *(imagPtr + 270) -= imag;
   *(imagPtr + 271) -= real;
   *(imagPtr + 272) -= real;
   *(imagPtr + 273) -= imag;
   *(imagPtr + 274) -= real;
   *(imagPtr + 275) -= imag;
   *(imagPtr + 276) += real;
   *(imagPtr + 277) += imag;
   *(imagPtr + 278) -= real;
   *(imagPtr + 279) += real;
   *(imagPtr + 280) -= imag;
   *(imagPtr + 281) += imag;
   *(imagPtr + 282) -= real;
   *(imagPtr + 283) -= real;
   *(imagPtr + 284) -= real;
   *(imagPtr + 285) -= real;
   *(imagPtr + 286) -= imag;
   *(imagPtr + 287) -= imag;
   *(imagPtr + 288) -= real;
   *(imagPtr + 289) += imag;
   *(imagPtr + 290) -= real;
   *(imagPtr + 291) -= real;
   *(imagPtr + 292) -= imag;
   *(imagPtr + 293) -= real;
   *(imagPtr + 294) += real;
   *(imagPtr + 295) -= imag;
   *(imagPtr + 296) -= imag;
   *(imagPtr + 297) += real;
   *(imagPtr + 298) += imag;
   *(imagPtr + 299) -= imag;
   *(imagPtr + 300) -= imag;
   *(imagPtr + 301) -= imag;
   *(imagPtr + 302) += imag;
   *(imagPtr + 303) -= real;
   *(imagPtr + 304) -= imag;
   *(imagPtr + 305) -= imag;
   *(imagPtr + 306) += imag;
   *(imagPtr + 307) -= real;
   *(imagPtr + 308) -= imag;
   *(imagPtr + 309) -= imag;
   *(imagPtr + 310) -= real;
   *(imagPtr + 311) += imag;
   *(imagPtr + 312) -= imag;
   *(imagPtr + 313) -= real;
   *(imagPtr + 314) -= real;
   *(imagPtr + 315) += imag;
   *(imagPtr + 316) += imag;
   *(imagPtr + 317) -= imag;
   *(imagPtr + 318) -= imag;
   *(imagPtr + 319) -= imag;
   *(imagPtr + 320) += imag;
   *(imagPtr + 321) += real;
   *(imagPtr + 322) += imag;
   *(imagPtr + 323) += real;
   *(imagPtr + 324) -= real;
   *(imagPtr + 325) += imag;
   *(imagPtr + 326) += imag;
   *(imagPtr + 327) -= imag;
   *(imagPtr + 328) -= real;
   *(imagPtr + 329) -= imag;
   *(imagPtr + 330) += real;
   *(imagPtr + 331) += imag;
   *(imagPtr + 332) -= imag;
   *(imagPtr + 333) -= real;
   *(imagPtr + 334) -= real;
   *(imagPtr + 335) -= real;
   *(imagPtr + 336) -= imag;
   *(imagPtr + 337) += real;
   *(imagPtr + 338) += real;
   *(imagPtr + 339) += imag;
   *(imagPtr + 340) += imag;
   *(imagPtr + 341) -= real;
   *(imagPtr + 342) -= real;
   *(imagPtr + 343) += real;
   *(imagPtr + 344) += imag;
   *(imagPtr + 345) += imag;
   *(imagPtr + 346) += imag;
   *(imagPtr + 347) -= real;
   *(imagPtr + 348) += imag;
   *(imagPtr + 349) -= real;
   *(imagPtr + 350) -= real;
   *(imagPtr + 351) -= real;
   *(imagPtr + 352) -= real;
   *(imagPtr + 353) -= real;
   *(imagPtr + 354) += real;
   *(imagPtr + 355) -= imag;
   *(imagPtr + 356) -= real;
   *(imagPtr + 357) -= imag;
   *(imagPtr + 358) -= real;
   *(imagPtr + 359) += imag;
   *(imagPtr + 360) += imag;
   *(imagPtr + 361) -= imag;
   *(imagPtr + 362) += real;
   *(imagPtr + 363) += imag;
   *(imagPtr + 364) -= real;
   *(imagPtr + 365) -= real;
   *(imagPtr + 366) += real;
   *(imagPtr + 367) += imag;
   *(imagPtr + 368) += real;
   *(imagPtr + 369) += real;
   *(imagPtr + 370) += imag;
   *(imagPtr + 371) -= real;
   *(imagPtr + 372) -= imag;
   *(imagPtr + 373) += real;
   *(imagPtr + 374) += real;
   *(imagPtr + 375) -= imag;
   *(imagPtr + 376) += imag;
   *(imagPtr + 377) -= imag;
   *(imagPtr + 378) += imag;
   *(imagPtr + 379) += real;
   *(imagPtr + 380) += real;
   *(imagPtr + 381) += imag;
   *(imagPtr + 382) -= imag;
   *(imagPtr + 383) -= real;
   *(imagPtr + 384) += real;
   *(imagPtr + 385) += imag;
   *(imagPtr + 386) -= real;
   *(imagPtr + 387) -= real;
   *(imagPtr + 388) += imag;
   *(imagPtr + 389) -= real;
   *(imagPtr + 390) -= imag;
   *(imagPtr + 391) -= real;
   *(imagPtr + 392) += imag;
   *(imagPtr + 393) += imag;
   *(imagPtr + 394) -= imag;
   *(imagPtr + 395) += imag;
   *(imagPtr + 396) -= imag;
   *(imagPtr + 397) -= real;
   *(imagPtr + 398) -= real;
   *(imagPtr + 399) += real;
   *(imagPtr + 400) += imag;
   *(imagPtr + 401) -= real;
   *(imagPtr + 402) += imag;
   *(imagPtr + 403) += imag;
   *(imagPtr + 404) -= real;
   *(imagPtr + 405) -= real;
   *(imagPtr + 406) -= real;
   *(imagPtr + 407) -= real;
   *(imagPtr + 408) += imag;
   *(imagPtr + 409) -= real;
   *(imagPtr + 410) += imag;
   *(imagPtr + 411) += imag;
   *(imagPtr + 412) += real;
   *(imagPtr + 413) += real;
   *(imagPtr + 414) -= imag;
   *(imagPtr + 415) += real;
   *(imagPtr + 416) -= imag;
   *(imagPtr + 417) -= real;
   *(imagPtr + 418) -= imag;
   *(imagPtr + 419) += imag;
   *(imagPtr + 420) += real;
   *(imagPtr + 421) -= imag;
   *(imagPtr + 422) -= imag;
   *(imagPtr + 423) -= real;
   *(imagPtr + 424) -= real;
   *(imagPtr + 425) += real;
   *(imagPtr + 426) += imag;
   *(imagPtr + 427) -= imag;
   *(imagPtr + 428) -= imag;
   *(imagPtr + 429) += imag;
   *(imagPtr + 430) += imag;
   *(imagPtr + 431) -= real;
   *(imagPtr + 432) -= real;
   *(imagPtr + 433) += real;
   *(imagPtr + 434) += real;
   *(imagPtr + 435) += real;
   *(imagPtr + 436) -= imag;
   *(imagPtr + 437) -= imag;
   *(imagPtr + 438) += real;
   *(imagPtr + 439) += real;
   *(imagPtr + 440) -= real;
   *(imagPtr + 441) += imag;
   *(imagPtr + 442) += imag;
   *(imagPtr + 443) -= real;
   *(imagPtr + 444) += real;
   *(imagPtr + 445) -= imag;
   *(imagPtr + 446) += real;
   *(imagPtr + 447) -= real;
   *(imagPtr + 448) += real;
   *(imagPtr + 449) += real;
   *(imagPtr + 450) += imag;
   *(imagPtr + 451) += real;
   *(imagPtr + 452) += imag;
   *(imagPtr + 453) += imag;
   *(imagPtr + 454) -= imag;
   *(imagPtr + 455) -= real;
   *(imagPtr + 456) -= imag;
   *(imagPtr + 457) -= real;
   *(imagPtr + 458) += imag;
   *(imagPtr + 459) -= real;
   *(imagPtr + 460) += imag;
   *(imagPtr + 461) += real;
   *(imagPtr + 462) -= real;
   *(imagPtr + 463) += imag;
   *(imagPtr + 464) -= real;
   *(imagPtr + 465) += real;
   *(imagPtr + 466) += real;
   *(imagPtr + 467) += real;
   *(imagPtr + 468) -= real;
   *(imagPtr + 469) += imag;
   *(imagPtr + 470) += imag;
   *(imagPtr + 471) -= imag;
   *(imagPtr + 472) -= imag;
   *(imagPtr + 473) += real;
   *(imagPtr + 474) -= imag;
   *(imagPtr + 475) -= imag;
   *(imagPtr + 476) += real;
   *(imagPtr + 477) -= real;
   *(imagPtr + 478) += real;
   *(imagPtr + 479) -= imag;
   *(imagPtr + 480) -= real;
   *(imagPtr + 481) += imag;
   *(imagPtr + 482) += imag;
   *(imagPtr + 483) -= imag;
   *(imagPtr + 484) += real;
   *(imagPtr + 485) -= real;
   *(imagPtr + 486) -= real;
   *(imagPtr + 487) += imag;
   *(imagPtr + 488) += real;
   *(imagPtr + 489) -= imag;
   *(imagPtr + 490) += real;
   *(imagPtr + 491) += real;
   *(imagPtr + 492) += real;
   *(imagPtr + 493) += real;
   *(imagPtr + 494) += real;
   *(imagPtr + 495) += imag;
   *(imagPtr + 496) += real;
   *(imagPtr + 497) += real;
   *(imagPtr + 498) += imag;
   *(imagPtr + 499) -= real;
   *(imagPtr + 500) += imag;
   *(imagPtr + 501) += imag;
   *(imagPtr + 502) -= real;
   *(imagPtr + 503) += imag;
   *(imagPtr + 504) -= imag;
   *(imagPtr + 505) += imag;
   *(imagPtr + 506) += imag;
   *(imagPtr + 507) += real;
   *(imagPtr + 508) += imag;
   *(imagPtr + 509) -= imag;
   *(imagPtr + 510) += imag;
   *(imagPtr + 511) += imag;
   *(imagPtr + 512) += real;
   *(imagPtr + 513) += imag;
   *(imagPtr + 514) -= real;
   *(imagPtr + 515) -= imag;
   *(imagPtr + 516) += imag;
   *(imagPtr + 517) += real;
   *(imagPtr + 518) -= imag;
   *(imagPtr + 519) -= real;
   *(imagPtr + 520) -= imag;
   *(imagPtr + 521) += real;
   *(imagPtr + 522) += real;
   *(imagPtr + 523) -= imag;
   *(imagPtr + 524) += imag;
   *(imagPtr + 525) -= imag;
   *(imagPtr + 526) += real;
   *(imagPtr + 527) -= real;
   *(imagPtr + 528) -= real;
   *(imagPtr + 529) += imag;
   *(imagPtr + 530) += imag;
   *(imagPtr + 531) -= real;
   *(imagPtr + 532) -= real;
   *(imagPtr + 533) -= real;
   *(imagPtr + 534) += real;
   *(imagPtr + 535) -= real;
   *(imagPtr + 536) -= real;
   *(imagPtr + 537) += real;
   *(imagPtr + 538) -= imag;
   *(imagPtr + 539) -= real;
   *(imagPtr + 540) += real;
   *(imagPtr + 541) += imag;
   *(imagPtr + 542) += imag;
   *(imagPtr + 543) -= imag;
   *(imagPtr + 544) -= imag;
   *(imagPtr + 545) += real;
   *(imagPtr + 546) -= imag;
   *(imagPtr + 547) -= imag;
   *(imagPtr + 548) += imag;
   *(imagPtr + 549) -= real;
   *(imagPtr + 550) += real;
   *(imagPtr + 551) += imag;
   *(imagPtr + 552) -= real;
   *(imagPtr + 553) += imag;
   *(imagPtr + 554) -= imag;
   *(imagPtr + 555) -= real;
   *(imagPtr + 556) -= real;
   *(imagPtr + 557) -= real;
   *(imagPtr + 558) += imag;
   *(imagPtr + 559) += imag;
   *(imagPtr + 560) -= real;
   *(imagPtr + 561) += imag;
   *(imagPtr + 562) -= imag;
   *(imagPtr + 563) += real;
   *(imagPtr + 564) -= real;
   *(imagPtr + 565) += real;
   *(imagPtr + 566) += real;
   *(imagPtr + 567) -= imag;
   *(imagPtr + 568) -= imag;
   *(imagPtr + 569) += imag;
   *(imagPtr + 570) += imag;
   *(imagPtr + 571) += real;
   *(imagPtr + 572) -= real;
   *(imagPtr + 573) -= imag;
   *(imagPtr + 574) -= real;
   *(imagPtr + 575) += real;
   *(imagPtr + 576) += real;
   *(imagPtr + 577) -= imag;
   *(imagPtr + 578) -= real;
   *(imagPtr + 579) += real;
   *(imagPtr + 580) -= imag;
   *(imagPtr + 581) += imag;
   *(imagPtr + 582) += imag;
   *(imagPtr + 583) += real;
   *(imagPtr + 584) -= real;
   *(imagPtr + 585) += imag;
   *(imagPtr + 586) -= imag;
   *(imagPtr + 587) -= imag;
   *(imagPtr + 588) -= real;
   *(imagPtr + 589) -= real;
   *(imagPtr + 590) += real;
   *(imagPtr + 591) += real;
   *(imagPtr + 592) += imag;
   *(imagPtr + 593) += real;
   *(imagPtr + 594) += real;
   *(imagPtr + 595) += real;
   *(imagPtr + 596) += real;
   *(imagPtr + 597) += real;
   *(imagPtr + 598) -= imag;
   *(imagPtr + 599) += real;
   *(imagPtr + 600) += imag;
   *(imagPtr + 601) += imag;
   *(imagPtr + 602) -= real;
   *(imagPtr + 603) += imag;
   *(imagPtr + 604) -= imag;
   *(imagPtr + 605) += real;
   *(imagPtr + 606) -= imag;
   *(imagPtr + 607) -= real;
   *(imagPtr + 608) += imag;
   *(imagPtr + 609) += imag;
   *(imagPtr + 610) -= imag;
   *(imagPtr + 611) += imag;
   *(imagPtr + 612) -= imag;
   *(imagPtr + 613) -= imag;
   *(imagPtr + 614) += real;
   *(imagPtr + 615) += real;
   *(imagPtr + 616) += imag;
   *(imagPtr + 617) -= real;
   *(imagPtr + 618) += imag;
   *(imagPtr + 619) += imag;
   *(imagPtr + 620) -= imag;
   *(imagPtr + 621) += real;
   *(imagPtr + 622) += real;
   *(imagPtr + 623) += imag;
   *(imagPtr + 624) -= imag;
   *(imagPtr + 625) -= real;
   *(imagPtr + 626) += imag;
   *(imagPtr + 627) += real;
   *(imagPtr + 628) -= real;
   *(imagPtr + 629) -= real;
   *(imagPtr + 630) += imag;
   *(imagPtr + 631) -= real;
   *(imagPtr + 632) -= imag;
   *(imagPtr + 633) += imag;
   *(imagPtr + 634) -= real;
   *(imagPtr + 635) += imag;
   *(imagPtr + 636) += real;
   *(imagPtr + 637) += real;
   *(imagPtr + 638) -= imag;
   *(imagPtr + 639) += real;
   *(imagPtr + 640) -= imag;
   *(imagPtr + 641) += imag;
   *(imagPtr + 642) -= imag;
   *(imagPtr + 643) += real;
   *(imagPtr + 644) += imag;
   *(imagPtr + 645) -= imag;
   *(imagPtr + 646) -= imag;
   *(imagPtr + 647) -= real;
   *(imagPtr + 648) += imag;
   *(imagPtr + 649) += real;
   *(imagPtr + 650) += real;
   *(imagPtr + 651) += imag;
   *(imagPtr + 652) += imag;
   *(imagPtr + 653) += real;
   *(imagPtr + 654) += real;
   *(imagPtr + 655) -= imag;
   *(imagPtr + 656) -= real;
   *(imagPtr + 657) -= imag;
   *(imagPtr + 658) -= imag;
   *(imagPtr + 659) -= real;
   *(imagPtr + 660) -= imag;
   *(imagPtr + 661) += real;
   *(imagPtr + 662) -= imag;
   *(imagPtr + 663) += imag;
   *(imagPtr + 664) -= real;
   *(imagPtr + 665) += imag;
   *(imagPtr + 666) += imag;
   *(imagPtr + 667) += imag;
   *(imagPtr + 668) += real;
   *(imagPtr + 669) -= real;
   *(imagPtr + 670) -= imag;
   *(imagPtr + 671) += imag;
   *(imagPtr + 672) += imag;
   *(imagPtr + 673) -= imag;
   *(imagPtr + 674) += real;
   *(imagPtr + 675) += real;
   *(imagPtr + 676) += real;
   *(imagPtr + 677) -= imag;
   *(imagPtr + 678) -= real;
   *(imagPtr + 679) -= real;
   *(imagPtr + 680) += imag;
   *(imagPtr + 681) -= real;
   *(imagPtr + 682) -= real;
   *(imagPtr + 683) -= real;
   *(imagPtr + 684) -= real;
   *(imagPtr + 685) += imag;
   *(imagPtr + 686) += imag;
   *(imagPtr + 687) -= imag;
   *(imagPtr + 688) -= imag;
   *(imagPtr + 689) += imag;
   *(imagPtr + 690) -= real;
   *(imagPtr + 691) += imag;
   *(imagPtr + 692) -= real;
   *(imagPtr + 693) += real;
   *(imagPtr + 694) -= real;
   *(imagPtr + 695) += imag;
   *(imagPtr + 696) += imag;
   *(imagPtr + 697) -= real;
   *(imagPtr + 698) -= imag;
   *(imagPtr + 699) -= real;
   *(imagPtr + 700) += imag;
   *(imagPtr + 701) -= real;
   *(imagPtr + 702) -= real;
   *(imagPtr + 703) += real;
   *(imagPtr + 704) -= imag;
   *(imagPtr + 705) += imag;
   *(imagPtr + 706) -= real;
   *(imagPtr + 707) += real;
   *(imagPtr + 708) += real;
   *(imagPtr + 709) += imag;
   *(imagPtr + 710) += real;
   *(imagPtr + 711) -= real;
   *(imagPtr + 712) += real;
   *(imagPtr + 713) += imag;
   *(imagPtr + 714) += real;
   *(imagPtr + 715) += real;
   *(imagPtr + 716) -= real;
   *(imagPtr + 717) -= imag;
   *(imagPtr + 718) -= imag;
   *(imagPtr + 719) += real;
   *(imagPtr + 720) += real;
   *(imagPtr + 721) -= imag;
   *(imagPtr + 722) += imag;
   *(imagPtr + 723) -= real;
   *(imagPtr + 724) -= real;
   *(imagPtr + 725) += real;
   *(imagPtr + 726) -= imag;
   *(imagPtr + 727) += real;
   *(imagPtr + 728) -= imag;
   *(imagPtr + 729) -= real;
   *(imagPtr + 730) += imag;
   *(imagPtr + 731) -= real;
   *(imagPtr + 732) -= real;
   *(imagPtr + 733) += real;
   *(imagPtr + 734) += imag;
   *(imagPtr + 735) -= real;
   *(imagPtr + 736) -= real;
   *(imagPtr + 737) -= real;
   *(imagPtr + 738) -= real;
   *(imagPtr + 739) -= imag;
   *(imagPtr + 740) -= real;
   *(imagPtr + 741) -= real;
   *(imagPtr + 742) += imag;
   *(imagPtr + 743) += imag;
   *(imagPtr + 744) += real;
   *(imagPtr + 745) -= imag;
   *(imagPtr + 746) -= real;
   *(imagPtr + 747) -= imag;
   *(imagPtr + 748) -= imag;
   *(imagPtr + 749) -= imag;
   *(imagPtr + 750) += real;
   *(imagPtr + 751) -= imag;
   *(imagPtr + 752) -= imag;
   *(imagPtr + 753) -= real;
   *(imagPtr + 754) -= real;
   *(imagPtr + 755) += imag;
   *(imagPtr + 756) -= real;
   *(imagPtr + 757) += real;
   *(imagPtr + 758) -= imag;
   *(imagPtr + 759) -= imag;
   *(imagPtr + 760) += imag;
   *(imagPtr + 761) -= real;
   *(imagPtr + 762) += imag;
   *(imagPtr + 763) += imag;
   *(imagPtr + 764) -= imag;
   *(imagPtr + 765) += imag;
   *(imagPtr + 766) += real;
   *(imagPtr + 767) += real;
   *(imagPtr + 768) -= real;
   *(imagPtr + 769) -= imag;
   *(imagPtr + 770) -= imag;
   *(imagPtr + 771) += real;
   *(imagPtr + 772) -= imag;
   *(imagPtr + 773) -= real;
   *(imagPtr + 774) -= real;
   *(imagPtr + 775) -= real;
   *(imagPtr + 776) += real;
   *(imagPtr + 777) -= real;
   *(imagPtr + 778) += imag;
   *(imagPtr + 779) += imag;
   *(imagPtr + 780) -= real;
   *(imagPtr + 781) -= imag;
   *(imagPtr + 782) -= real;
   *(imagPtr + 783) -= imag;
   *(imagPtr + 784) -= imag;
   *(imagPtr + 785) -= real;
   *(imagPtr + 786) += real;
   *(imagPtr + 787) += imag;
   *(imagPtr + 788) += imag;
   *(imagPtr + 789) -= real;
   *(imagPtr + 790) += real;
   *(imagPtr + 791) -= imag;
   *(imagPtr + 792) -= imag;
   *(imagPtr + 793) += real;
   *(imagPtr + 794) += imag;
   *(imagPtr + 795) -= real;
   *(imagPtr + 796) -= imag;
   *(imagPtr + 797) -= real;
   *(imagPtr + 798) -= imag;
   *(imagPtr + 799) -= real;
   *(imagPtr + 800) += imag;
   *(imagPtr + 801) += imag;
   *(imagPtr + 802) -= real;
   *(imagPtr + 803) -= real;
   *(imagPtr + 804) -= real;
   *(imagPtr + 805) -= real;
   *(imagPtr + 806) -= real;
   *(imagPtr + 807) += real;
   *(imagPtr + 808) += imag;
   *(imagPtr + 809) -= imag;
   *(imagPtr + 810) -= real;
   *(imagPtr + 811) += real;
   *(imagPtr + 812) -= imag;
   *(imagPtr + 813) -= imag;
   *(imagPtr + 814) += imag;
   *(imagPtr + 815) -= real;
   *(imagPtr + 816) -= real;
   *(imagPtr + 817) += imag;
   *(imagPtr + 818) -= real;
   *(imagPtr + 819) += imag;
   *(imagPtr + 820) += real;
   *(imagPtr + 821) -= real;
   *(imagPtr + 822) -= real;
   *(imagPtr + 823) += real;
   *(imagPtr + 824) += imag;
   *(imagPtr + 825) -= imag;
   *(imagPtr + 826) += real;
   *(imagPtr + 827) -= real;
   *(imagPtr + 828) -= imag;
   *(imagPtr + 829) += real;
   *(imagPtr + 830) += imag;
   *(imagPtr + 831) += real;
   *(imagPtr + 832) -= real;
   *(imagPtr + 833) -= imag;
   *(imagPtr + 834) += real;
   *(imagPtr + 835) += imag;
   *(imagPtr + 836) -= imag;
   *(imagPtr + 837) -= real;
   *(imagPtr + 838) += real;
   *(imagPtr + 839) -= imag;
   *(imagPtr + 840) -= imag;
   *(imagPtr + 841) += imag;
   *(imagPtr + 842) += real;
   *(imagPtr + 843) += imag;
   *(imagPtr + 844) -= imag;
   *(imagPtr + 845) -= real;
   *(imagPtr + 846) -= imag;
   *(imagPtr + 847) += real;
   *(imagPtr + 848) += real;
   *(imagPtr + 849) += real;
   *(imagPtr + 850) -= imag;
   *(imagPtr + 851) -= imag;
   *(imagPtr + 852) += imag;
   *(imagPtr + 853) -= imag;
   *(imagPtr + 854) -= real;
   *(imagPtr + 855) += imag;
   *(imagPtr + 856) += real;
   *(imagPtr + 857) -= real;
   *(imagPtr + 858) -= real;
   *(imagPtr + 859) -= real;
   *(imagPtr + 860) -= imag;
   *(imagPtr + 861) += real;
   *(imagPtr + 862) += imag;
   *(imagPtr + 863) -= real;
   *(imagPtr + 864) += imag;
   *(imagPtr + 865) += real;
   *(imagPtr + 866) += imag;
   *(imagPtr + 867) -= real;
   *(imagPtr + 868) -= imag;
   *(imagPtr + 869) += real;
   *(imagPtr + 870) += real;
   *(imagPtr + 871) -= real;
   *(imagPtr + 872) -= real;
   *(imagPtr + 873) -= real;
   *(imagPtr + 874) += real;
   *(imagPtr + 875) += real;
   *(imagPtr + 876) += real;
   *(imagPtr + 877) -= imag;
   *(imagPtr + 878) -= real;
   *(imagPtr + 879) -= imag;
   *(imagPtr + 880) += imag;
   *(imagPtr + 881) += imag;
   *(imagPtr + 882) -= imag;
   *(imagPtr + 883) -= imag;
   *(imagPtr + 884) += real;
   *(imagPtr + 885) -= imag;
   *(imagPtr + 886) += real;
   *(imagPtr + 887) += imag;
   *(imagPtr + 888) -= real;
   *(imagPtr + 889) -= imag;
   *(imagPtr + 890) += imag;
   *(imagPtr + 891) += real;
   *(imagPtr + 892) += imag;
   *(imagPtr + 893) += real;
   *(imagPtr + 894) -= real;
   *(imagPtr + 895) += real;
   *(imagPtr + 896) -= real;
   *(imagPtr + 897) -= imag;
   *(imagPtr + 898) -= imag;
   *(imagPtr + 899) += imag;
   *(imagPtr + 900) += real;
   *(imagPtr + 901) -= imag;
   *(imagPtr + 902) += real;
   *(imagPtr + 903) += imag;
   *(imagPtr + 904) -= real;
   *(imagPtr + 905) -= real;
   *(imagPtr + 906) += real;
   *(imagPtr + 907) -= real;
   *(imagPtr + 908) += imag;
   *(imagPtr + 909) += real;
   *(imagPtr + 910) += real;
   *(imagPtr + 911) += real;
   *(imagPtr + 912) -= imag;
   *(imagPtr + 913) += real;
   *(imagPtr + 914) -= imag;
   *(imagPtr + 915) -= real;
   *(imagPtr + 916) -= imag;
   *(imagPtr + 917) += imag;
   *(imagPtr + 918) += real;
   *(imagPtr + 919) -= real;
   *(imagPtr + 920) += imag;
   *(imagPtr + 921) -= real;
   *(imagPtr + 922) += real;
   *(imagPtr + 923) += real;
   *(imagPtr + 924) += imag;
   *(imagPtr + 925) -= imag;
   *(imagPtr + 926) += real;
   *(imagPtr + 927) += imag;
   *(imagPtr + 928) -= imag;
   *(imagPtr + 929) -= imag;
   *(imagPtr + 930) += real;
   *(imagPtr + 931) -= real;
   *(imagPtr + 932) += real;
   *(imagPtr + 933) += imag;
   *(imagPtr + 934) += imag;
   *(imagPtr + 935) -= imag;
   *(imagPtr + 936) += real;
   *(imagPtr + 937) += real;
   *(imagPtr + 938) -= real;
   *(imagPtr + 939) += real;
   *(imagPtr + 940) -= real;
   *(imagPtr + 941) += real;
   *(imagPtr + 942) -= real;
   *(imagPtr + 943) += real;
   *(imagPtr + 944) -= real;
   *(imagPtr + 945) -= real;
   *(imagPtr + 946) -= imag;
   *(imagPtr + 947) += imag;
   *(imagPtr + 948) -= imag;
   *(imagPtr + 949) -= imag;
   *(imagPtr + 950) += imag;
   *(imagPtr + 951) -= imag;
   *(imagPtr + 952) -= imag;
   *(imagPtr + 953) -= real;
   *(imagPtr + 954) -= real;
   *(imagPtr + 955) -= real;
   *(imagPtr + 956) -= imag;
   *(imagPtr + 957) -= imag;
   *(imagPtr + 958) -= imag;
   *(imagPtr + 959) += imag;
   *(imagPtr + 960) -= real;
   *(imagPtr + 961) -= real;
   *(imagPtr + 962) -= real;
   *(imagPtr + 963) += real;
   *(imagPtr + 964) -= real;
   *(imagPtr + 965) += real;
   *(imagPtr + 966) += imag;
   *(imagPtr + 967) += real;
   *(imagPtr + 968) -= real;
   *(imagPtr + 969) += real;
   *(imagPtr + 970) -= imag;
   *(imagPtr + 971) += imag;
   *(imagPtr + 972) -= imag;
   *(imagPtr + 973) -= real;
   *(imagPtr + 974) -= imag;
   *(imagPtr + 975) += imag;
   *(imagPtr + 976) += real;
   *(imagPtr + 977) += real;
   *(imagPtr + 978) += real;
   *(imagPtr + 979) -= real;
   *(imagPtr + 980) += real;
   *(imagPtr + 981) += imag;
   *(imagPtr + 982) -= imag;
   *(imagPtr + 983) += imag;
   *(imagPtr + 984) += real;
   *(imagPtr + 985) -= real;
   *(imagPtr + 986) += imag;
   *(imagPtr + 987) += imag;
   *(imagPtr + 988) += real;
   *(imagPtr + 989) += real;
   *(imagPtr + 990) -= real;
   *(imagPtr + 991) -= real;
   *(imagPtr + 992) += real;
   *(imagPtr + 993) += imag;
   *(imagPtr + 994) += real;
   *(imagPtr + 995) += imag;
   *(imagPtr + 996) -= real;
   *(imagPtr + 997) += real;
   *(imagPtr + 998) -= imag;
   *(imagPtr + 999) += imag;
   *(imagPtr + 1000) -= real;
   *(imagPtr + 1001) += imag;
   *(imagPtr + 1002) -= real;
   *(imagPtr + 1003) -= real;
   *(imagPtr + 1004) += imag;
   *(imagPtr + 1005) -= imag;
   *(imagPtr + 1006) += real;
   *(imagPtr + 1007) += imag;
   *(imagPtr + 1008) += imag;
   *(imagPtr + 1009) -= real;
   *(imagPtr + 1010) += imag;
   *(imagPtr + 1011) += imag;
   *(imagPtr + 1012) -= real;
   *(imagPtr + 1013) += imag;
   *(imagPtr + 1014) += imag;
   *(imagPtr + 1015) += imag;
   *(imagPtr + 1016) += imag;
   *(imagPtr + 1017) += imag;
   *(imagPtr + 1018) += imag;
   *(imagPtr + 1019) += imag;
   *(imagPtr + 1020) += imag;
   *(imagPtr + 1021) += imag;


   // Threshold the correlation
   double accReal = (double)accRealArr[accIndex];
   double accImag = (double)accImagArr[accIndex];
   double mag = sqrt(accReal*accReal + accImag*accImag);
   if (_correlationMagnitude > 0.0)
   {
      // Previous sample was peak.  Check if this one is larger.
      _oddData = _oddSample ^ ((mag > _correlationMagnitude) ? 0 : 1);
      // Start passing capsule data out of this block.
      _capsuleLen = CAPSULE_SYMBOL_LENGTH;
      // Reset the correlation magnitude to start looking for next peak.
      _correlationMagnitude = 0.0;
   }
   else if (_primed && (mag > 4*_movingSum/CODE_LENGTH)) // 8 times the average
   {
      printf("Peak on sample %ld\n", _sampleNum);
      _correlationMagnitude = mag;
   }

   // Update the moving sum of magnitudes for threshold comparisons
   _movingSum -= _movingSumAddends[_movingSumIndex];
   _movingSumAddends[_movingSumIndex] = mag;
   _movingSum += mag;
   _movingSumIndex = (_movingSumIndex+1)%(2*CODE_LENGTH);
   if (!_movingSumIndex)
   {
      _primed = 1;
   }

   ++accIndex;

   // Prevent need for modulo arithematic for circular buffer.  Instead copy back to start of array.
   if (accIndex + CODE_LENGTH == ACCUMULATOR_LENGTH)
   {
      for(int i=0; i<CODE_LENGTH; ++i)
      {
         accRealArr[i] = accRealArr[accIndex+i];
         accImagArr[i] = accImagArr[accIndex+i];
      }
      accIndex = 0;
   }
}


void
correlator_cc_impl::forecast (int noutput_items, gr_vector_int &ninput_items_required)
{
   ninput_items_required[0] = noutput_items;
}

int
correlator_cc_impl::general_work (
   int noutput_items,
   gr_vector_int &ninput_items,
   gr_vector_const_void_star &input_items,
   gr_vector_void_star &output_items
)
{
   const gr_complex* in = reinterpret_cast<const gr_complex*>(input_items[0]);
   gr_complex *out = reinterpret_cast<gr_complex*>(output_items[0]);
   int samplesRemaining = ninput_items[0];
   int samplesOutput = 0;
   int samplesRead = 0;

   while (samplesRemaining)
   {
      while (samplesRemaining && _capsuleLen)
      {
         // Peak has been detected, output this sample (only correct clock)

	 if (_oddSample == _oddData)
	 {
	    out[samplesOutput++] = in[samplesRead];
	    --_capsuleLen;
	 }
         ++_sampleNum;
	 ++samplesRead;
	 --samplesRemaining;
	 _oddSample ^= 1;
      }

      while (samplesRemaining && !_capsuleLen)
      {
	 detect_peak(in[samplesRead].real(), in[samplesRead].imag());
         ++_sampleNum;
	 ++samplesRead;
	 --samplesRemaining;
	 _oddSample ^= 1;
      }
   }

   // Tell runtime system how many input items we consumed on each input stream.
   consume_each (samplesRead);

   // Tell runtime system how many output items we produced.
   return samplesOutput;
}

} /* namespace correlator_cc */
} /* namespace gr */
